# CRM для офлайн точек продаж

## Возможности
- Вход по паролю (секрету) и сессия.
- Добавление точек продаж через админку.
- Импорт Excel/CSV с автоматическим распознаванием колонок.
- Сводные показатели остатков, продаж и выручки.
- Экспорт Excel с отдельными вкладками по каждой точке.
- Отслеживание поставок через CDEK по трек-номеру.
- Поставки создаются в попап-окне с выбором откуда/куда (склад или точки продаж).
- Визуальные карточки поставок с индикатором движения и обновлением статуса.

## Запуск
```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
export APP_PASSWORD="your-secret"
python app.py
```

Откройте `http://localhost`.

## Формат колонок
CRM распознает ключевые колонки по названиям (например: `товар`, `остаток`, `продажи`, `сумма`, `дата`).
Если нужные колонки не найдены — появится ошибка.
Также поддерживаются выгрузки формата: `Бренд`, `Номенклатура`, `Характеристика`,
`Отгруз по списку`, `Отгруз факт`. Текстовые пометки вроде `0 (продались)` будут
преобразованы в число автоматически.

## Отслеживание поставок
Для получения статусов по трек-номеру CDEK используется API v2 с OAuth2.
Настройте переменные окружения:

```bash
export CDEK_CLIENT_ID="your-client-id"
export CDEK_CLIENT_SECRET="your-client-secret"
export CDEK_API_BASE="https://api.cdek.ru/v2"
export CDEK_TOKEN_URL="${CDEK_API_BASE}/oauth/token"
export CDEK_TRACK_URL="${CDEK_API_BASE}/trackings/by/track_number"
export CDEK_UPDATE_INTERVAL="300"
```

## Требования
Все зависимости перечислены в `requirements.txt`.
