<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CASHER CRM — Точки продаж</title>
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body
    class="crm-body"
    data-authed="{{ 'true' if authed else 'false' }}"
    data-role="{{ role }}"
  >
    <div class="crm-background" aria-hidden="true">
      <span class="crm-orb orb-1"></span>
      <span class="crm-orb orb-2"></span>
      <span class="crm-orb orb-3"></span>
    </div>
    <div id="app">
      <aside class="sidebar">
        <a class="ghost menu-link" href="/">В меню</a>
        <button class="primary admin-only" id="add-location-btn">Добавить точку</button>
        <button class="ghost admin-only" id="add-shipment-btn">Новая поставка</button>
        <button class="ghost" id="export-btn">Экспорт Excel</button>
        <div class="hint">
          <h3>Быстрые подсказки</h3>
          <ul>
            <li>Данные загружаются из Excel или CSV.</li>
            <li>Колонки распознаются автоматически.</li>
            <li>Все изменения сохраняются.</li>
          </ul>
        </div>
      </aside>

      <main class="main">
        <header class="topbar">
          <div>
            <h2>Точки продаж</h2>
            <span class="subtitle">Следите за остатками, продажами и выручкой</span>
          </div>
        </header>

        <section class="grid" id="location-grid"></section>

        <section class="section">
          <div class="section-header">
            <h2>Отслеживание поставок</h2>
            <span class="subtitle">Статусы CDEK и движение товара</span>
          </div>
          <div class="grid" id="shipment-grid"></div>
        </section>
      </main>
    </div>

    <div class="modal hidden" id="location-modal">
      <div class="modal-card">
        <div class="modal-header">
          <h2>Новая точка продаж</h2>
        </div>
        <div class="modal-close-row">
          <button class="icon-btn" data-close="location-modal">×</button>
        </div>
        <label>
          Название
          <input type="text" id="location-name" placeholder="Например, ТЦ Север" />
        </label>
        <label>
          Адрес
          <input type="text" id="location-address" placeholder="Улица, дом" />
        </label>
        <button class="primary" id="location-save">Сохранить</button>
        <div class="error" id="location-error"></div>
      </div>
    </div>

    <div class="modal hidden" id="upload-modal">
      <div class="modal-card">
        <div class="modal-header">
          <h2>Загрузить Excel</h2>
        </div>
        <div class="modal-close-row">
          <button class="icon-btn" data-close="upload-modal">×</button>
        </div>
        <div class="upload-info" id="upload-location"></div>
        <input type="file" id="upload-file" accept=".xlsx,.xls,.csv" />
        <button class="primary" id="upload-submit">Импортировать</button>
        <div class="error" id="upload-error"></div>
      </div>
    </div>

    <div class="modal hidden" id="records-modal">
      <div class="modal-card wide">
        <div class="modal-header">
          <h2 id="records-title">Детали точки</h2>
        </div>
        <div class="modal-close-row">
          <button class="icon-btn" data-close="records-modal">×</button>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Товар</th>
                <th>Остаток</th>
                <th>Продажи (шт.)</th>
                <th>Выручка</th>
                <th>Дата</th>
                <th>Файл</th>
              </tr>
            </thead>
            <tbody id="records-body"></tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="shipment-modal">
      <div class="modal-card">
        <div class="modal-header">
          <h2>Добавить поставку</h2>
        </div>
        <div class="modal-close-row">
          <button class="icon-btn" data-close="shipment-modal">×</button>
        </div>
        <label>
          Откуда
          <select id="shipment-origin"></select>
        </label>
        <label>
          Куда
          <select id="shipment-destination"></select>
        </label>
        <label>
          Трек-номер СДЭК
          <input type="text" id="shipment-display-number" placeholder="Например, 10213725494" />
        </label>
        <button class="primary" id="shipment-save">Сохранить</button>
        <div class="error" id="shipment-error"></div>
      </div>
    </div>

    <div class="modal hidden" id="shipment-details-modal">
      <div class="modal-card wide">
        <div class="modal-header">
          <div>
            <h2 id="shipment-detail-title">Поставка</h2>
            <div class="subtitle" id="shipment-detail-route"></div>
          </div>
        </div>
        <div class="modal-close-row">
          <button class="icon-btn" data-close="shipment-details-modal">×</button>
        </div>
        <div class="shipment-detail-actions">
          <button
            class="icon-btn danger"
            id="shipment-detail-delete"
            data-delete=""
            aria-label="Удалить"
          >
            ×
          </button>
          <a
            class="cdek-button"
            id="shipment-cdek-link"
            href="https://www.cdek.ru/ru/tracking"
            target="_blank"
            rel="noopener"
          >
            <span class="cdek-logo">CDEK</span>
            Открыть в СДЭК
          </a>
        </div>
        <div class="detail-section">
          <h3>Основная информация</h3>
          <div class="detail-grid" id="shipment-detail-main"></div>
        </div>
        <div class="detail-section">
          <h3>Дополнительная информация</h3>
          <div class="detail-grid" id="shipment-detail-extra"></div>
        </div>
        <div class="detail-section">
          <h3>История статусов</h3>
          <div class="status-list" id="shipment-detail-statuses"></div>
        </div>
      </div>
    </div>

    <div class="toast-container" id="toast-container" aria-live="polite"></div>

    <script src="/static/app.js"></script>
  </body>
</html>
